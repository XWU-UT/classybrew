!function(a){"object"==typeof exports?module.exports=a():"function"==typeof define&&define.amd?define(a):geostats=a()}(function(){var a=function(a){return"number"==typeof a&&parseFloat(a)==parseInt(a,10)&&!isNaN(a)},b=function(a){return a},c=function(a){return!isNaN(parseFloat(a))&&isFinite(a)};Array.prototype.indexOf||(Array.prototype.indexOf=function(a,b){if(void 0===this||null===this)throw new TypeError('"this" is null or not defined');var c=this.length>>>0;for(b=+b||0,1/0===Math.abs(b)&&(b=0),0>b&&(b+=c,0>b&&(b=0));c>b;b++)if(this[b]===a)return b;return-1});var d=function(d){this.objectId="",this.separator=" - ",this.legendSeparator=this.separator,this.method="",this.precision=0,this.precisionflag="auto",this.roundlength=2,this.is_uniqueValues=!1,this.debug=!1,this.bounds=Array(),this.ranges=Array(),this.inner_ranges=null,this.colors=Array(),this.counter=Array(),this.stat_sorted=null,this.stat_mean=null,this.stat_median=null,this.stat_sum=null,this.stat_max=null,this.stat_min=null,this.stat_pop=null,this.stat_variance=null,this.stat_stddev=null,this.stat_cov=null,this.log=function(a){1==this.debug&&console.log(this.objectID+"(object id) :: "+a)},this.setBounds=function(a){this.log("Setting bounds ("+a.length+") : "+a.join()),this.bounds=Array(),this.bounds=a},this.setSerie=function(a){this.log("Setting serie ("+a.length+") : "+a.join()),this.serie=Array(),this.serie=a,this.setPrecision()},this.setColors=function(a){this.log("Setting color ramp ("+a.length+") : "+a.join()),this.colors=a},this.doCount=function(){if(!this._nodata()){var a=this.sorted();for(this.counter=new Array,i=0;i<this.bounds.length-1;i++)this.counter[i]=0;for(j=0;j<a.length;j++){var b=this.getClass(a[j]);this.counter[b]++}}},this.setPrecision=function(a){if("undefined"!=typeof a&&(this.precisionflag="manual",this.precision=a),"auto"==this.precisionflag)for(var b=0;b<this.serie.length;b++){if(isNaN(this.serie[b]+"")||-1==(this.serie[b]+"").toString().indexOf("."))var c=0;else var c=(this.serie[b]+"").split(".")[1].length;c>this.precision&&(this.precision=c)}this.log("Calling setPrecision(). Mode : "+this.precisionflag+" - Decimals : "+this.precision),this.serie=this.decimalFormat(this.serie)},this.decimalFormat=function(a){for(var b=new Array,d=0;d<a.length;d++)b[d]=c(a[d])?parseFloat(a[d].toFixed(this.precision)):a[d];return b},this.setRanges=function(){for(this.ranges=Array(),i=0;i<this.bounds.length-1;i++)this.ranges[i]=this.bounds[i]+this.separator+this.bounds[i+1]},this.min=function(){return this._nodata()?void 0:(this.stat_min=Math.min.apply(null,this.serie),this.stat_min)},this.max=function(){return this.stat_max=Math.max.apply(null,this.serie),this.stat_max},this.sum=function(){if(!this._nodata()){if(null==this.stat_sum)for(this.stat_sum=0,i=0;i<this.pop();i++)this.stat_sum+=parseFloat(this.serie[i]);return this.stat_sum}},this.pop=function(){return this._nodata()?void 0:(null==this.stat_pop&&(this.stat_pop=this.serie.length),this.stat_pop)},this.mean=function(){return this._nodata()?void 0:(null==this.stat_mean&&(this.stat_mean=parseFloat(this.sum()/this.pop())),this.stat_mean)},this.median=function(){if(!this._nodata()){if(null==this.stat_median){this.stat_median=0;var a=this.sorted();this.stat_median=a.length%2?parseFloat(a[Math.ceil(a.length/2)-1]):(parseFloat(a[a.length/2-1])+parseFloat(a[a.length/2]))/2}return this.stat_median}},this.variance=function(){if(round="undefined"==typeof round?!0:!1,!this._nodata()){if(null==this.stat_variance){for(var a=0,b=0;b<this.pop();b++)a+=Math.pow(this.serie[b]-this.mean(),2);this.stat_variance=a/this.pop(),1==round&&(this.stat_variance=Math.round(this.stat_variance*Math.pow(10,this.roundlength))/Math.pow(10,this.roundlength))}return this.stat_variance}},this.stddev=function(a){return a="undefined"==typeof a?!0:!1,this._nodata()?void 0:(null==this.stat_stddev&&(this.stat_stddev=Math.sqrt(this.variance()),1==a&&(this.stat_stddev=Math.round(this.stat_stddev*Math.pow(10,this.roundlength))/Math.pow(10,this.roundlength))),this.stat_stddev)},this.cov=function(a){return a="undefined"==typeof a?!0:!1,this._nodata()?void 0:(null==this.stat_cov&&(this.stat_cov=this.stddev()/this.mean(),1==a&&(this.stat_cov=Math.round(this.stat_cov*Math.pow(10,this.roundlength))/Math.pow(10,this.roundlength))),this.stat_cov)},this._nodata=function(){return 0==this.serie.length?(alert("Error. You should first enter a serie!"),1):0},this._hasNegativeValue=function(){for(i=0;i<this.serie.length;i++)if(this.serie[i]<0)return!0;return!1},this._hasZeroValue=function(){for(i=0;i<this.serie.length;i++)if(0===parseFloat(this.serie[i]))return!0;return!1},this.sorted=function(){return null==this.stat_sorted&&(this.stat_sorted=this.serie.sort(0==this.is_uniqueValues?function(a,b){return a-b}:function(a,b){var c=a.toString().toLowerCase(),d=b.toString().toLowerCase();return d>c?-1:c>d?1:0})),this.stat_sorted},this.info=function(){if(!this._nodata()){var a="";return a+=b("Population")+" : "+this.pop()+" - ["+b("Min")+" : "+this.min()+" | "+b("Max")+" : "+this.max()+"]\n",a+=b("Mean")+" : "+this.mean()+" - "+b("Median")+" : "+this.median()+"\n",a+=b("Variance")+" : "+this.variance()+" - "+b("Standard deviation")+" : "+this.stddev()+" - "+b("Coefficient of variation")+" : "+this.cov()+"\n"}},this.setClassManually=function(a){return this._nodata()?void 0:a[0]!==this.min()||a[a.length-1]!==this.max()?void alert(b("Given bounds may not be correct! please check your input.\nMin value : "+this.min()+" / Max value : "+this.max())):(this.setBounds(a),this.setRanges(),this.method=b("manual classification")+" ("+(a.length-1)+" "+b("classes")+")",this.bounds)},this.getClassEqInterval=function(a){if(!this._nodata()){var c=this.max(),d=Array(),e=this.min(),f=(c-this.min())/a;for(i=0;a>=i;i++)d[i]=e,e+=f;return d[a]=c,this.setBounds(d),this.setRanges(),this.method=b("eq. intervals")+" ("+a+" "+b("classes")+")",this.bounds}},this.getQuantiles=function(a){for(var b=this.sorted(),c=[],d=this.pop()/a,e=1;a>e;e++){var f=Math.round(e*d+.49);c.push(b[f-1])}return c},this.getClassQuantile=function(a){if(!this._nodata()){var c=this.sorted(),d=this.getQuantiles(a);return d.unshift(c[0]),d[c.length-1]!==c[c.length-1]&&d.push(c[c.length-1]),this.setBounds(d),this.setRanges(),this.method=b("quantile")+" ("+a+" "+b("classes")+")",this.bounds}},this.getClassStdDeviation=function(a){if(!this._nodata()){var c=(this.max(),this.min(),Array());if(a%2==1){var d=Math.floor(a/2),e=d+1;for(c[d]=this.mean()-this.stddev()/2,c[e]=this.mean()+this.stddev()/2,i=d-1;i>0;i--){var f=c[i+1]-this.stddev();c[i]=f}for(i=e+1;a>i;i++){var f=c[i-1]+this.stddev();c[i]=f}}else{var g=a/2;for(c[g]=this.mean(),i=g-1;i>0;i--){var f=c[i+1]-this.stddev();c[i]=f}for(i=g+1;a>i;i++){var f=c[i-1]+this.stddev();c[i]=f}}return c[0]=this.min(),c[a]=this.max(),this.setBounds(c),this.setRanges(),this.method=b("std deviation")+" ("+a+" "+b("classes")+")",this.bounds}},this.getClassGeometricProgression=function(a){if(!this._nodata()){if(this._hasNegativeValue()||this._hasZeroValue())return void alert(b("geometric progression can't be applied with a serie containing negative or zero values."));var c=Array(),d=this.min(),e=this.max(),f=Math.log(e)/Math.LN10,g=Math.log(d)/Math.LN10,h=(f-g)/a;for(i=0;a>i;i++)c[i]=0==i?g:c[i-1]+h;return c=c.map(function(a){return Math.pow(10,a)}),c.push(this.max()),this.setBounds(c),this.setRanges(),this.method=b("geometric progression")+" ("+a+" "+b("classes")+")",this.bounds}},this.getClassArithmeticProgression=function(a){if(!this._nodata()){var c=0;for(i=1;a>=i;i++)c+=i;var d=Array(),e=this.min(),f=this.max(),g=(f-e)/c;for(i=0;a>=i;i++)d[i]=0==i?e:d[i-1]+i*g;return this.setBounds(d),this.setRanges(),this.method=b("arithmetic progression")+" ("+a+" "+b("classes")+")",this.bounds}},this.getClassJenks=function(a){if(!this._nodata()){dataList=this.sorted();for(var c=[],d=0,e=dataList.length+1;e>d;d++){for(var f=[],g=0,h=a+1;h>g;g++)f.push(0);c.push(f)}for(var i=[],j=0,k=dataList.length+1;k>j;j++){for(var l=[],m=0,n=a+1;n>m;m++)l.push(0);i.push(l)}for(var o=1,p=a+1;p>o;o++){c[0][o]=1,i[0][o]=0;for(var q=1,r=dataList.length+1;r>q;q++)i[q][o]=1/0;var s=0}for(var t=2,u=dataList.length+1;u>t;t++){for(var v=0,w=0,x=0,y=1,z=t+1;z>y;y++){var A=t-y+1,B=parseFloat(dataList[A-1]);w+=B*B,v+=B,x+=1,s=w-v*v/x;var C=A-1;if(0!=C)for(var D=2,E=a+1;E>D;D++)i[t][D]>=s+i[C][D-1]&&(c[t][D]=A,i[t][D]=s+i[C][D-1])}c[t][1]=1,i[t][1]=s}var F=dataList.length,G=[];for(j=0,k=a+1;k>j;j++)G.push(0);G[a]=parseFloat(dataList[dataList.length-1]),G[0]=parseFloat(dataList[0]);for(var H=a;H>=2;){var I=parseInt(c[F][H]-2);G[H-1]=dataList[I],F=parseInt(c[F][H]-1),H-=1}return G[0]==G[1]&&(G[0]=0),this.setBounds(G),this.setRanges(),this.method=b("Jenks")+" ("+a+" "+b("classes")+")",this.bounds}},this.getClassUniqueValues=function(){if(!this._nodata()){this.is_uniqueValues=!0;var a=this.sorted(),c=Array();for(i=0;i<this.pop();i++)-1===c.indexOf(a[i])&&c.push(a[i]);return this.bounds=c,this.method=b("unique values"),c}},this.getClass=function(a){for(i=0;i<this.bounds.length;i++)if(1==this.is_uniqueValues){if(a==this.bounds[i])return i}else if(parseFloat(a)<=this.bounds[i+1])return i;return b("Unable to get value's class.")},this.getRanges=function(){return this.ranges},this.getRangeNum=function(a){var b,c;for(c=0;c<this.ranges.length;c++)if(b=this.ranges[c].split(/ - /),a<=parseFloat(b[1]))return c},this.getInnerRanges=function(){if(null!=this.inner_ranges)return this.inner_ranges;var a=new Array,b=this.sorted(),c=1;for(i=0;i<b.length;i++){if(0==i)var d=b[i];if(parseFloat(b[i])>parseFloat(this.bounds[c])){a[c-1]=""+d+this.separator+b[i-1];var d=b[i];c++}if(c==this.bounds.length-1)return a[c-1]=""+d+this.separator+b[b.length-1],this.inner_ranges=a,this.inner_ranges}},this.getSortedlist=function(){return this.sorted().join(", ")},this.getHtmlLegend=function(c,d,e,f,g){var h="";if(this.doCount(),ccolors=null!=c?c:this.colors,lg=null!=d?d:"Legend",getcounter=null!=e?!0:!1,fn=null!=f?f:function(a){return a},null==g&&(g="default"),"discontinuous"==g&&(this.getInnerRanges(),-1!==this.counter.indexOf(0)))return void alert(b("Geostats cannot apply 'discontinuous' mode to the getHtmlLegend() method because some classes are not populated.\nPlease switch to 'default' or 'distinct' modes. Exit!"));if(ccolors.length<this.ranges.length)return void alert(b("The number of colors should fit the number of ranges. Exit!"));var j='<div class="geostats-legend"><div class="geostats-legend-title">'+b(lg)+"</div>";if(0==this.is_uniqueValues)for(i=0;i<this.ranges.length;i++){getcounter===!0&&(h=' <span class="geostats-legend-counter">('+this.counter[i]+")</span>");var k=this.ranges[i].split(this.separator),l=parseFloat(k[0]).toFixed(this.precision),m=parseFloat(k[1]).toFixed(this.precision);if("distinct"==g&&0!=i&&(a(l)?l=parseInt(l)+1:(l=parseFloat(l)+1/Math.pow(10,this.precision),l=parseFloat(l).toFixed(this.precision))),"discontinuous"==g)var k=this.inner_ranges[i].split(this.separator),l=parseFloat(k[0]).toFixed(this.precision),m=parseFloat(k[1]).toFixed(this.precision);var n=fn(l)+this.legendSeparator+fn(m);j+='<div><div class="geostats-legend-block" style="background-color:'+ccolors[i]+'"></div> '+n+h+"</div>"}else for(i=0;i<this.bounds.length;i++){getcounter===!0&&(h=' <span class="geostats-legend-counter">('+this.counter[i]+")</span>");var n=fn(this.bounds[i]);j+='<div><div class="geostats-legend-block" style="background-color:'+ccolors[i]+'"></div> '+n+h+"</div>"}return j+="</div>"},this.objectID=(new Date).getUTCMilliseconds(),this.log("Creating new geostats object"),"undefined"!=typeof d&&d.length>0?(this.serie=d,this.setPrecision(),this.log("Setting serie ("+d.length+") : "+d.join())):this.serie=Array(),this.getJenks=this.getClassJenks,this.getGeometricProgression=this.getClassGeometricProgression,this.getEqInterval=this.getClassEqInterval,this.getQuantile=this.getClassQuantile,this.getStdDeviation=this.getClassStdDeviation,this.getUniqueValues=this.getClassUniqueValues,this.getArithmeticProgression=this.getClassArithmeticProgression};return d});